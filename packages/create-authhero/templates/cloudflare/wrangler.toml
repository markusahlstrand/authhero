# ════════════════════════════════════════════════════════════════════════════
# AuthHero Cloudflare Worker Configuration
# ════════════════════════════════════════════════════════════════════════════
# This file is safe for version control. Sensitive IDs should go in:
# - wrangler.local.toml (local development - gitignored)
# - GitHub Secrets / Cloudflare Dashboard (production)
#
# For local development with your own Cloudflare resources:
#   cp wrangler.toml wrangler.local.toml
#   # Add your database_id to wrangler.local.toml
#   npm run dev  # Uses wrangler.local.toml automatically
# ════════════════════════════════════════════════════════════════════════════

name = "authhero-server"
main = "src/index.ts"
compatibility_date = "2024-11-20"
compatibility_flags = ["nodejs_compat"]

# ════════════════════════════════════════════════════════════════════════════
# Static Assets (CSS, JS, Widget)
# ════════════════════════════════════════════════════════════════════════════
# Serve static assets from the authhero package.
# This includes the widget, CSS, and client-side JavaScript.
# Assets are copied from node_modules/authhero/dist/assets to dist/assets
# during the build process (see copy-assets.js).
# Assets are served at their path: /u/widget/*, /u/css/*, /u/js/*
[assets]
directory = "./dist/assets"

# ════════════════════════════════════════════════════════════════════════════
# D1 Database binding
# ════════════════════════════════════════════════════════════════════════════
# This configuration uses a local D1 database by default.
# For remote development/production, copy to wrangler.local.toml and update.
#
# Setup:
# 1. Create database: npx wrangler d1 create authhero-db
# 2. Copy to local config: cp wrangler.toml wrangler.local.toml
# 3. Update database_id in wrangler.local.toml with the ID from step 1
#
[[d1_databases]]
binding = "AUTH_DB"
database_name = "authhero-db"
database_id = "local"  # Use "local" for local dev, or your actual ID in wrangler.local.toml
migrations_dir = "node_modules/@authhero/drizzle/drizzle"

# ════════════════════════════════════════════════════════════════════════════
# OPTIONAL: Custom Domain
# ════════════════════════════════════════════════════════════════════════════
# To route your worker to a custom domain, use zone_name (not zone_id):
#
# [[routes]]
# pattern = "auth.yourdomain.com/*"
# zone_name = "yourdomain.com"

# ════════════════════════════════════════════════════════════════════════════
# OPTIONAL: Analytics Engine for centralized logging
# ════════════════════════════════════════════════════════════════════════════
# To enable Analytics Engine:
# 1. Create dataset in Cloudflare Dashboard: Workers & Pages > Analytics Engine
# 2. Uncomment the binding below
# 3. Add CLOUDFLARE_ACCOUNT_ID and CLOUDFLARE_API_TOKEN to .dev.vars
# 4. Uncomment the Analytics Engine code in src/index.ts
#
# [[analytics_engine_datasets]]
# binding = "AUTH_LOGS"
# dataset = "authhero_logs"

# ════════════════════════════════════════════════════════════════════════════
# OPTIONAL: Rate Limiting
# ════════════════════════════════════════════════════════════════════════════
# To enable Rate Limiting:
# 1. Rate limiting is available on Workers Paid plan ($5/month)
# 2. Uncomment the binding below
# 3. Implement rate limiting logic in src/index.ts
#
# [[unsafe.bindings]]
# name = "RATE_LIMITER"
# type = "ratelimit"
# namespace_id = "1001"  # Unique namespace ID for this limiter
# simple = { limit = 100, period = 60 }  # 100 requests per 60 seconds

# Optional: Enable observability
# [observability]
# enabled = true
