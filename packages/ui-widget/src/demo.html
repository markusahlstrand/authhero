<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AuthHero Widget Demo</title>
    <script type="module" src="/build/authhero-widget.esm.js"></script>
    <script nomodule src="/build/authhero-widget.js"></script>
    <!-- Load theme presets -->
    <link rel="stylesheet" href="/src/themes/variables.css" />
    <link rel="stylesheet" href="/src/themes/presets.css" />
    <style>
      * {
        box-sizing: border-box;
      }

      body {
        font-family:
          -apple-system,
          BlinkMacSystemFont,
          'Segoe UI',
          Roboto,
          sans-serif;
        background-color: #f5f5f5;
        min-height: 100vh;
        margin: 0;
        padding: 2rem;
        transition: background-color 0.3s;
      }

      body.dark-mode {
        background-color: #111827;
      }

      .demo-container {
        max-width: 1200px;
        margin: 0 auto;
      }

      h1 {
        text-align: center;
        margin-bottom: 1rem;
        color: #333;
      }

      body.dark-mode h1 {
        color: #f9fafb;
      }

      .controls {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        justify-content: center;
        margin-bottom: 1rem;
        padding: 1rem;
        background: white;
        border-radius: 8px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      }

      body.dark-mode .controls {
        background: #1f2937;
      }

      .controls-section {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        justify-content: center;
        width: 100%;
        padding-bottom: 0.5rem;
        border-bottom: 1px solid #e5e7eb;
      }

      .controls-section:last-child {
        border-bottom: none;
        padding-bottom: 0;
        padding-top: 0.5rem;
      }

      body.dark-mode .controls-section {
        border-color: #374151;
      }

      .controls-label {
        font-size: 0.75rem;
        color: #6b7280;
        font-weight: 500;
        width: 100%;
        text-align: center;
        margin-bottom: 0.25rem;
      }

      .controls button {
        padding: 0.5rem 1rem;
        font-size: 0.875rem;
        border: 1px solid #d1d5db;
        background: white;
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.2s;
      }

      body.dark-mode .controls button {
        background: #374151;
        border-color: #4b5563;
        color: #f9fafb;
      }

      .controls button:hover {
        background: #f3f4f6;
      }

      body.dark-mode .controls button:hover {
        background: #4b5563;
      }

      .controls button.active {
        background: #0066cc;
        color: white;
        border-color: #0066cc;
      }

      /* Theme color buttons */
      .controls button.color-btn {
        min-width: 70px;
      }

      .widget-wrapper {
        display: flex;
        justify-content: center;
        padding: 2rem;
      }

      .event-log {
        max-width: 600px;
        margin: 2rem auto;
        padding: 1rem;
        background: #1e1e1e;
        border-radius: 8px;
        color: #d4d4d4;
        font-family: 'Menlo', 'Monaco', 'Courier New', monospace;
        font-size: 0.75rem;
        max-height: 200px;
        overflow-y: auto;
      }

      .event-log h3 {
        margin: 0 0 0.5rem;
        color: #9ca3af;
        font-size: 0.875rem;
      }

      .event-log .event {
        margin: 0.25rem 0;
        padding: 0.25rem 0;
        border-bottom: 1px solid #333;
      }

      .event-log .event-type {
        color: #569cd6;
      }

      .event-log .event-data {
        color: #ce9178;
      }

      .json-editor {
        max-width: 800px;
        margin: 2rem auto;
        padding: 1rem;
        background: white;
        border-radius: 8px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      }

      .json-editor h3 {
        margin: 0 0 0.5rem;
        font-size: 0.875rem;
        color: #666;
      }

      .json-editor textarea {
        width: 100%;
        height: 300px;
        font-family: 'Menlo', 'Monaco', 'Courier New', monospace;
        font-size: 0.75rem;
        padding: 1rem;
        border: 1px solid #d1d5db;
        border-radius: 6px;
        resize: vertical;
      }

      .json-editor button {
        margin-top: 0.5rem;
        padding: 0.5rem 1rem;
        background: #0066cc;
        color: white;
        border: none;
        border-radius: 6px;
        cursor: pointer;
      }

      .json-editor .error {
        color: #dc2626;
        font-size: 0.75rem;
        margin-top: 0.5rem;
      }

      body.dark-mode .json-editor {
        background: #1f2937;
      }

      body.dark-mode .json-editor h3 {
        color: #9ca3af;
      }

      body.dark-mode .json-editor textarea {
        background: #374151;
        border-color: #4b5563;
        color: #f9fafb;
      }
    </style>
  </head>
  <body>
    <div class="demo-container">
      <h1>AuthHero Widget Demo</h1>

      <!-- Screen Controls -->
      <div class="controls">
        <div class="controls-section">
          <span class="controls-label">Screens</span>
          <button data-screen="identifier" class="active">Identifier</button>
          <button data-screen="login">Login</button>
          <button data-screen="login-with-social">Login + Social</button>
          <button data-screen="login-error">Login Error</button>
          <button data-screen="signup">Signup</button>
          <button data-screen="mfa-totp">MFA (TOTP)</button>
          <button data-screen="mfa-sms">MFA (SMS)</button>
          <button data-screen="forgot-password">Forgot Password</button>
          <button data-screen="reset-password">Reset Password</button>
          <button data-screen="email-verification">Email Verification</button>
          <button data-screen="passwordless-email">Passwordless</button>
          <button data-screen="success">Success</button>
        </div>
      </div>

      <!-- Theme Controls -->
      <div class="controls">
        <div class="controls-section">
          <span class="controls-label">Theme Preset</span>
          <button data-theme="default" class="active">Default</button>
          <button data-theme="ah-theme-minimal">Minimal</button>
          <button data-theme="ah-theme-rounded">Rounded</button>
          <button data-theme="ah-theme-dark">Dark</button>
        </div>
        <div class="controls-section">
          <span class="controls-label">Brand Color (via branding prop)</span>
          <button data-color="#0066cc" class="color-btn active">Blue</button>
          <button data-color="#7D68F4" class="color-btn">Purple</button>
          <button data-color="#ec4899" class="color-btn">Pink</button>
          <button data-color="#f97316" class="color-btn">Orange</button>
          <button data-color="#14b8a6" class="color-btn">Teal</button>
          <button data-color="#16a34a" class="color-btn">Green</button>
        </div>
      </div>

      <div class="widget-wrapper">
        <authhero-widget id="demo-widget"></authhero-widget>
      </div>

      <div class="event-log">
        <h3>Event Log</h3>
        <div id="events"></div>
      </div>

      <div class="json-editor">
        <h3>Edit Screen JSON (live)</h3>
        <textarea id="json-input"></textarea>
        <button id="apply-json">Apply Changes</button>
        <div id="json-error" class="error"></div>
      </div>
    </div>

    <script type="module">
      // Screen fixtures - embedded for demo
      // Using Auth0 Forms component schema
      const fixtures = {
        'identifier': {
          "action": "/api/auth/identifier",
          "method": "POST",
          "title": "Sign in to your account",
          "components": [
            { "id": "email", "type": "EMAIL", "category": "FIELD", "order": 1, "required": true, "label": "Email", "config": { "placeholder": "Enter your email" } },
            { "id": "submit", "type": "NEXT_BUTTON", "category": "BLOCK", "order": 2, "config": { "text": "Continue" } },
            { "id": "divider", "type": "DIVIDER", "category": "BLOCK", "order": 3 },
            { "id": "social", "type": "SOCIAL", "category": "FIELD", "order": 4, "config": { "providers": ["google"] } }
          ],
          "messages": [],
          "links": [{ "text": "Don't have an account?", "linkText": "Sign up", "href": "/signup" }]
        },
        'login': {
          "action": "/api/auth/login",
          "method": "POST",
          "title": "Sign in to your account",
          "components": [
            { "id": "email", "type": "EMAIL", "category": "FIELD", "order": 1, "required": true, "label": "Email address", "config": { "placeholder": "you@example.com" } },
            { "id": "password", "type": "PASSWORD", "category": "FIELD", "order": 2, "required": true, "label": "Password", "config": { "placeholder": "Enter your password" } },
            { "id": "submit", "type": "NEXT_BUTTON", "category": "BLOCK", "order": 3, "config": { "text": "Sign in" } }
          ],
          "messages": [],
          "links": [{ "text": "Forgot your password?", "href": "/forgot-password" }]
        },
        'login-with-social': {
          "action": "/api/auth/login",
          "method": "POST",
          "title": "Sign in",
          "components": [
            { "id": "social", "type": "SOCIAL", "category": "FIELD", "order": 1, "config": { "providers": ["google", "github", "microsoft"] } },
            { "id": "divider", "type": "DIVIDER", "category": "BLOCK", "order": 2 },
            { "id": "email", "type": "EMAIL", "category": "FIELD", "order": 3, "required": true, "label": "Email", "config": { "placeholder": "you@example.com" } },
            { "id": "password", "type": "PASSWORD", "category": "FIELD", "order": 4, "required": true, "label": "Password", "config": {} },
            { "id": "submit", "type": "NEXT_BUTTON", "category": "BLOCK", "order": 5, "config": { "text": "Sign in" } }
          ],
          "messages": []
        },
        'login-error': {
          "action": "/api/auth/login",
          "method": "POST",
          "title": "Sign in to your account",
          "components": [
            { "id": "email", "type": "EMAIL", "category": "FIELD", "order": 1, "required": true, "label": "Email address", "config": { "placeholder": "you@example.com" } },
            { "id": "password", "type": "PASSWORD", "category": "FIELD", "order": 2, "required": true, "label": "Password", "config": {}, "messages": [{ "text": "Password is incorrect", "type": "error" }] },
            { "id": "submit", "type": "NEXT_BUTTON", "category": "BLOCK", "order": 3, "config": { "text": "Sign in" } }
          ],
          "messages": [{ "text": "Invalid email or password. Please try again.", "type": "error" }]
        },
        'signup': {
          "action": "/api/auth/register",
          "method": "POST",
          "title": "Create your account",
          "components": [
            { "id": "name", "type": "TEXT", "category": "FIELD", "order": 1, "required": true, "label": "Full name", "config": { "placeholder": "John Doe" } },
            { "id": "email", "type": "EMAIL", "category": "FIELD", "order": 2, "required": true, "label": "Email address", "config": { "placeholder": "you@example.com" } },
            { "id": "password", "type": "PASSWORD", "category": "FIELD", "order": 3, "required": true, "label": "Password", "hint": "Must be at least 8 characters", "config": { "min_length": 8 } },
            { "id": "password_confirm", "type": "PASSWORD", "category": "FIELD", "order": 4, "required": true, "label": "Confirm password", "config": {} },
            { "id": "tos", "type": "LEGAL", "category": "FIELD", "order": 5, "required": true, "config": { "text": "I agree to the <a href=\"/terms\">Terms of Service</a> and <a href=\"/privacy\">Privacy Policy</a>", "html": true } },
            { "id": "submit", "type": "NEXT_BUTTON", "category": "BLOCK", "order": 6, "config": { "text": "Create account" } }
          ],
          "messages": [],
          "links": [{ "text": "Already have an account?", "linkText": "Sign in", "href": "/login" }]
        },
        'mfa-totp': {
          "action": "/api/auth/mfa/verify",
          "method": "POST",
          "title": "Two-factor authentication",
          "description": "Enter the 6-digit code from your authenticator app",
          "components": [
            { "id": "totp_code", "type": "TEXT", "category": "FIELD", "order": 1, "required": true, "label": "Verification code", "config": { "placeholder": "000000", "max_length": 6 } },
            { "id": "submit", "type": "NEXT_BUTTON", "category": "BLOCK", "order": 2, "config": { "text": "Verify" } }
          ],
          "messages": [],
          "links": [{ "text": "Can't access your authenticator?", "linkText": "Use backup code", "href": "/mfa/backup" }]
        },
        'mfa-sms': {
          "action": "/api/auth/mfa/sms/verify",
          "method": "POST",
          "title": "Verify your phone",
          "description": "We sent a verification code to your phone ending in ••••42",
          "components": [
            { "id": "code", "type": "TEXT", "category": "FIELD", "order": 1, "required": true, "label": "Verification code", "config": { "placeholder": "000000", "max_length": 6 } },
            { "id": "submit", "type": "NEXT_BUTTON", "category": "BLOCK", "order": 2, "config": { "text": "Verify" } },
            { "id": "resend", "type": "RESEND_BUTTON", "category": "BLOCK", "order": 3, "config": { "text": "Didn't receive a code? Send again" } }
          ],
          "messages": []
        },
        'forgot-password': {
          "action": "/api/auth/forgot-password",
          "method": "POST",
          "title": "Reset your password",
          "description": "Enter your email address and we'll send you a link to reset your password.",
          "components": [
            { "id": "email", "type": "EMAIL", "category": "FIELD", "order": 1, "required": true, "label": "Email address", "config": { "placeholder": "you@example.com" } },
            { "id": "submit", "type": "NEXT_BUTTON", "category": "BLOCK", "order": 2, "config": { "text": "Send reset link" } }
          ],
          "messages": [],
          "links": [{ "text": "Remember your password?", "linkText": "Sign in", "href": "/login" }]
        },
        'reset-password': {
          "action": "/api/auth/reset-password",
          "method": "POST",
          "title": "Set new password",
          "components": [
            { "id": "password", "type": "PASSWORD", "category": "FIELD", "order": 1, "required": true, "label": "New password", "hint": "Must be at least 8 characters", "config": { "min_length": 8 } },
            { "id": "password_confirm", "type": "PASSWORD", "category": "FIELD", "order": 2, "required": true, "label": "Confirm new password", "config": {} },
            { "id": "submit", "type": "NEXT_BUTTON", "category": "BLOCK", "order": 3, "config": { "text": "Reset password" } }
          ],
          "messages": []
        },
        'email-verification': {
          "action": "/api/auth/verify-email/resend",
          "method": "POST",
          "title": "Verify your email",
          "description": "We sent a verification link to user@example.com. Click the link in the email to verify your account.",
          "components": [
            { "id": "submit", "type": "NEXT_BUTTON", "category": "BLOCK", "order": 1, "config": { "text": "Resend verification email" } }
          ],
          "messages": [{ "text": "Check your inbox for the verification email", "type": "success" }]
        },
        'passwordless-email': {
          "action": "/api/auth/passwordless/email",
          "method": "POST",
          "title": "Sign in with email",
          "description": "Enter your email and we'll send you a magic link to sign in.",
          "components": [
            { "id": "email", "type": "EMAIL", "category": "FIELD", "order": 1, "required": true, "label": "Email address", "config": { "placeholder": "you@example.com" } },
            { "id": "submit", "type": "NEXT_BUTTON", "category": "BLOCK", "order": 2, "config": { "text": "Send magic link" } }
          ],
          "messages": [],
          "links": [{ "text": "Prefer to use a password?", "linkText": "Sign in with password", "href": "/login" }]
        },
        'success': {
          "action": "/",
          "method": "GET",
          "title": "Welcome back!",
          "description": "You will be redirected to your dashboard shortly.",
          "components": [
            { "id": "continue", "type": "NEXT_BUTTON", "category": "BLOCK", "order": 1, "config": { "text": "Continue to Dashboard" } }
          ],
          "messages": [{ "text": "You have successfully signed in.", "type": "success" }]
        }
      };

      const widget = document.getElementById('demo-widget');
      const eventsEl = document.getElementById('events');
      const jsonInput = document.getElementById('json-input');
      const jsonError = document.getElementById('json-error');
      const screenButtons = document.querySelectorAll('[data-screen]');

      let currentScreen = 'identifier';

      // Initialize with identifier screen
      widget.screen = fixtures.identifier;
      jsonInput.value = JSON.stringify(fixtures.identifier, null, 2);

      // Screen switcher
      screenButtons.forEach(btn => {
        btn.addEventListener('click', () => {
          const screenName = btn.dataset.screen;
          if (fixtures[screenName]) {
            currentScreen = screenName;
            widget.screen = fixtures[screenName];
            jsonInput.value = JSON.stringify(fixtures[screenName], null, 2);
            jsonError.textContent = '';
            
            // Update active button
            screenButtons.forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
          }
        });
      });

      // Theme preset switching (CSS classes)
      const themeButtons = document.querySelectorAll('[data-theme]');
      let currentTheme = 'default';

      themeButtons.forEach(btn => {
        btn.addEventListener('click', () => {
          const theme = btn.dataset.theme;
          
          // Remove old theme class
          if (currentTheme !== 'default') {
            widget.classList.remove(currentTheme);
          }
          // Add new theme class
          if (theme !== 'default') {
            widget.classList.add(theme);
          }
          currentTheme = theme;
          
          // Handle dark mode for body
          document.body.classList.toggle('dark-mode', theme === 'ah-theme-dark');
          
          // Update active state
          themeButtons.forEach(b => b.classList.toggle('active', b.dataset.theme === theme));
        });
      });

      // Brand color switching (via branding prop)
      const colorButtons = document.querySelectorAll('[data-color]');
      let currentBranding = { colors: { primary: '#0066cc' } };

      colorButtons.forEach(btn => {
        btn.addEventListener('click', () => {
          const color = btn.dataset.color;
          currentBranding = { colors: { primary: color } };
          widget.branding = currentBranding;
          
          // Update active state
          colorButtons.forEach(b => b.classList.toggle('active', b.dataset.color === color));
        });
      });

      // Apply JSON changes
      document.getElementById('apply-json').addEventListener('click', () => {
        try {
          const screen = JSON.parse(jsonInput.value);
          widget.screen = screen;
          jsonError.textContent = '';
        } catch (e) {
          jsonError.textContent = `Invalid JSON: ${e.message}`;
        }
      });

      // Event logging
      function logEvent(type, detail) {
        const eventEl = document.createElement('div');
        eventEl.className = 'event';
        eventEl.innerHTML = `
          <span class="event-type">${type}</span>: 
          <span class="event-data">${JSON.stringify(detail)}</span>
        `;
        eventsEl.insertBefore(eventEl, eventsEl.firstChild);
        
        // Keep only last 20 events
        while (eventsEl.children.length > 20) {
          eventsEl.removeChild(eventsEl.lastChild);
        }
      }

      widget.addEventListener('formSubmit', (e) => {
        logEvent('formSubmit', e.detail.data);
        
        // Simulate flow progression
        if (currentScreen === 'login' && e.detail.data.email && e.detail.data.password) {
          setTimeout(() => {
            currentScreen = 'mfa-totp';
            widget.screen = fixtures['mfa-totp'];
            jsonInput.value = JSON.stringify(fixtures['mfa-totp'], null, 2);
            screenButtons.forEach(b => b.classList.toggle('active', b.dataset.screen === 'mfa-totp'));
          }, 500);
        } else if (currentScreen === 'mfa-totp' && e.detail.data.totp_code) {
          setTimeout(() => {
            currentScreen = 'success';
            widget.screen = fixtures.success;
            jsonInput.value = JSON.stringify(fixtures.success, null, 2);
            screenButtons.forEach(b => b.classList.toggle('active', b.dataset.screen === 'success'));
          }, 500);
        }
      });

      widget.addEventListener('buttonClick', (e) => {
        logEvent('buttonClick', e.detail);
      });

      widget.addEventListener('screenChange', (e) => {
        logEvent('screenChange', { id: e.detail.id, title: e.detail.title });
      });
    </script>
  </body>
</html>